<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Birthday ğŸŒ™âœ¨</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  overflow:hidden;
  background:#0f0f14;
  color:white;
}
section{
  position:absolute;
  width:100%;
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  transition:0.8s;
}
.hidden{opacity:0;pointer-events:none;}
.visible{opacity:1;pointer-events:auto;}

button{
  padding:12px 25px;
  border:none;
  border-radius:30px;
  background:#ff4da6;
  color:white;
  font-size:16px;
  cursor:pointer;
  margin-top:20px;
}

.note{
  max-width:600px;
  font-size:18px;
  line-height:1.6;
  margin-top:20px;
}

.gold{
  background:linear-gradient(90deg,#fff,#ffd700,#fff);
  background-size:200%;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  animation:shine 3s linear infinite;
}
@keyframes shine{
  from{background-position:0%}
  to{background-position:200%}
}

.candle{font-size:45px;margin-top:20px;}
.flame{animation:flicker 0.2s infinite alternate;}
@keyframes flicker{from{transform:scale(1);}to{transform:scale(1.2);}}

.petal{
  position:fixed;
  top:-10px;
  font-size:18px;
  animation:fall linear infinite;
}
@keyframes fall{
  to{transform:translateY(110vh) rotate(360deg);}
}
</style>
</head>
<body>

<section id="intro" class="visible">
  <h1>ğŸ¬ A Cinematic Surprise Awaits...</h1>
  <button onclick="startGame()">Begin ğŸŒ</button>
</section>

<section id="globeSection" class="hidden"></section>

<section id="ending" class="hidden">
  <div class="note" id="note"></div>
  <div class="candle">ğŸ•¯ï¸ <span class="flame">ğŸ”¥</span></div>
  <button onclick="goBack()">â¬… Back</button>
</section>

<audio id="jetSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_2e3bca0b3f.mp3"></audio>

<script>
let scene,camera,renderer,globe;
let markers={};
let raycaster=new THREE.Raycaster();
let mouse=new THREE.Vector2();
let flightLine;

function startGame(){
  intro.classList.replace("visible","hidden");
  globeSection.classList.replace("hidden","visible");
  initGlobe();
}

function initGlobe(){
  scene=new THREE.Scene();

  camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,0.1,1000);
  camera.position.z=5;

  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth,window.innerHeight);
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.outputColorSpace = THREE.SRGBColorSpace;
  globeSection.appendChild(renderer.domElement);

  const ambient=new THREE.AmbientLight(0xffffff,0.6);
  scene.add(ambient);

  const directional=new THREE.DirectionalLight(0xffffff,1);
  directional.position.set(5,3,5);
  scene.add(directional);

  const geometry=new THREE.SphereGeometry(2,64,64);
  const textureLoader=new THREE.TextureLoader();

  textureLoader.load(
    "https://threejs.org/examples/textures/land_ocean_ice_cloud_2048.jpg",
    function(texture){
      texture.colorSpace = THREE.SRGBColorSpace;
      const material=new THREE.MeshStandardMaterial({map:texture});
      globe=new THREE.Mesh(geometry,material);
      scene.add(globe);
      animate();
      addMarkers();
    }
  );
}

function animate(){
  requestAnimationFrame(animate);
  if(globe) globe.rotation.y+=0.002;
  renderer.render(scene,camera);
}

function latLongToVector3(lat,lon,radius){
  const phi=(90-lat)*(Math.PI/180);
  const theta=(lon+180)*(Math.PI/180);
  return new THREE.Vector3(
    -(radius*Math.sin(phi)*Math.cos(theta)),
    radius*Math.cos(phi),
    radius*Math.sin(phi)*Math.sin(theta)
  );
}

function addMarkers(){
  const countries={
    india:[20,78],
    saudi:[24,45],
    japan:[36,138],
    korea:[36,128]
  };

  for(let c in countries){
    const pos=latLongToVector3(countries[c][0],countries[c][1],2.05);
    const marker=new THREE.Mesh(
      new THREE.SphereGeometry(0.07,16,16),
      new THREE.MeshBasicMaterial({color:0xff4da6})
    );
    marker.position.copy(pos);
    marker.userData.country=c;
    scene.add(marker);
    markers[c]=marker;
  }
}

window.addEventListener("click",(event)=>{
  mouse.x=(event.clientX/window.innerWidth)*2-1;
  mouse.y=-(event.clientY/window.innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);
  const intersects=raycaster.intersectObjects(Object.values(markers));
  if(intersects.length>0){
    travel(intersects[0].object.userData.country);
  }
});

function drawFlightArc(startVec,endVec){
  const mid=startVec.clone().add(endVec).multiplyScalar(0.5);
  mid.normalize().multiplyScalar(3);

  const curve=new THREE.QuadraticBezierCurve3(startVec,mid,endVec);
  const points=curve.getPoints(100);
  const geometry=new THREE.BufferGeometry().setFromPoints(points);
  const material=new THREE.LineBasicMaterial({color:0xffffff});
  flightLine=new THREE.Line(geometry,material);
  scene.add(flightLine);
}

const notes={
india:`Happy Birthday ğŸŒ™âœ¨<br><br>
Soft mornings, warm laughter & magic moments for <span class="gold">Nimra ğŸ’•</span> ğŸŒ¸ğŸ«ğŸ’–ğŸŒ¹<br><br>
à¤œà¤¨à¥à¤®à¤¦à¤¿à¤¨ à¤®à¥à¤¬à¤¾à¤°à¤• à¤¹à¥‹ ğŸ‰`,
saudi:`Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ Ø³Ø¹ÙŠØ¯ ğŸ‰ğŸŒ¸ğŸ« <span class="gold">Nimra ğŸ’•</span>`,
japan:`ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã† ğŸ‰ğŸŒ¸ğŸ« <span class="gold">Nimra ğŸ’•</span>`,
korea:`ìƒì¼ ì¶•í•˜í•´ìš” ğŸ‰ğŸŒ¸ğŸ« <span class="gold">Nimra ğŸ’•</span>`
};

function travel(country){
  jetSound.play();

  const start=new THREE.Vector3(0,0,2.05);
  const end=markers[country].position.clone();

  drawFlightArc(start,end);

  setTimeout(()=>{
    globeSection.classList.replace("visible","hidden");
    ending.classList.replace("hidden","visible");
    document.getElementById("note").innerHTML=notes[country];
  },2000);
}

/* petals */
setInterval(()=>{
  let petal=document.createElement("div");
  petal.className="petal";
  petal.innerHTML="ğŸŒ¹";
  petal.style.left=Math.random()*100+"vw";
  petal.style.animationDuration=(5+Math.random()*5)+"s";
  document.body.appendChild(petal);
  setTimeout(()=>petal.remove(),10000);
},400);

/* mic blow */
let audioContext,analyser,dataArray;
document.addEventListener("click",async()=>{
  try{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    audioContext=new(window.AudioContext||window.webkitAudioContext)();
    analyser=audioContext.createAnalyser();
    const mic=audioContext.createMediaStreamSource(stream);
    mic.connect(analyser);
    analyser.fftSize=256;
    dataArray=new Uint8Array(analyser.frequencyBinCount);
    detectBlow();
  }catch(e){}
},{once:true});

function detectBlow(){
  analyser.getByteFrequencyData(dataArray);
  let volume=dataArray.reduce((a,b)=>a+b)/dataArray.length;
  if(volume>45){
    document.querySelector(".flame").style.opacity="0";
    confetti({particleCount:200,spread:100,origin:{y:0.6}});
  }
  requestAnimationFrame(detectBlow);
}

function goBack(){
  ending.classList.replace("visible","hidden");
  globeSection.classList.replace("hidden","visible");
}
</script>

</body>
</html>

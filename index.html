<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Birthday ğŸŒ™âœ¨</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
:root{
  --bg-light:#fff0f6;
  --bg-dark:#0f0f14;
  --pink:#ff4da6;
}

body{
  margin:0;
  font-family:'Poppins',sans-serif;
  overflow:hidden;
  transition:0.5s;
}

.light{background:#fff0f6;color:#111;}
.dark{background:#0f0f14;color:#fff;}

section{
  position:absolute;
  width:100%;
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  transition:0.8s;
}

.hidden{opacity:0;pointer-events:none;}
.visible{opacity:1;pointer-events:auto;}

button{
  padding:12px 25px;
  border:none;
  border-radius:30px;
  background:var(--pink);
  color:white;
  font-size:16px;
  cursor:pointer;
  margin-top:20px;
}

.theme-toggle{
  position:fixed;
  top:15px;
  right:15px;
  z-index:999;
}

canvas{display:block;}

.note{
  max-width:600px;
  font-size:18px;
  line-height:1.6;
  margin-top:20px;
}

.gold{
  background:linear-gradient(90deg,#fff,#ffd700,#fff);
  background-size:200%;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  animation:shine 3s linear infinite;
}

@keyframes shine{
  from{background-position:0%}
  to{background-position:200%}
}

.candle{font-size:45px;margin-top:20px;}
.flame{animation:flicker 0.2s infinite alternate;}
@keyframes flicker{from{transform:scale(1);}to{transform:scale(1.2);}}

/* petals */
.petal{
  position:fixed;
  top:-10px;
  font-size:18px;
  animation:fall linear infinite;
}
@keyframes fall{
  to{transform:translateY(110vh) rotate(360deg);}
}
</style>
</head>
<body class="light">

<button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>

<section id="intro" class="visible">
  <h1>ğŸ¬ A Cinematic Surprise Awaits...</h1>
  <button onclick="startGame()">Begin ğŸŒ</button>
</section>

<section id="globeSection" class="hidden"></section>

<section id="ending" class="hidden">
  <div class="note" id="note"></div>
  <div class="candle">ğŸ•¯ï¸ <span class="flame">ğŸ”¥</span></div>
  <button onclick="goBack()">â¬… Back</button>
</section>

<audio id="jetSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_2e3bca0b3f.mp3"></audio>

<script>
function toggleTheme(){
  document.body.classList.toggle("dark");
  document.body.classList.toggle("light");
}

function startGame(){
  intro.classList.replace("visible","hidden");
  globeSection.classList.replace("hidden","visible");
}

/* THREE JS GLOBE */
let scene=new THREE.Scene();
let camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
let renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
renderer.setSize(window.innerWidth,window.innerHeight);
globeSection.appendChild(renderer.domElement);

let geometry=new THREE.SphereGeometry(2,64,64);
let texture=new THREE.TextureLoader().load("https://threejs.org/examples/textures/land_ocean_ice_cloud_2048.jpg");
let material=new THREE.MeshStandardMaterial({map:texture});
let globe=new THREE.Mesh(geometry,material);
scene.add(globe);

let light=new THREE.PointLight(0xffffff,1);
light.position.set(5,3,5);
scene.add(light);

camera.position.z=5;

function animate(){
  requestAnimationFrame(animate);
  globe.rotation.y+=0.002;
  renderer.render(scene,camera);
}
animate();

/* country markers */
function latLongToVector3(lat,lon,radius){
  let phi=(90-lat)*(Math.PI/180);
  let theta=(lon+180)*(Math.PI/180);
  return new THREE.Vector3(
    -(radius*Math.sin(phi)*Math.cos(theta)),
    radius*Math.cos(phi),
    radius*Math.sin(phi)*Math.sin(theta)
  );
}

let countries={
  india:[20,78],
  saudi:[24,45],
  japan:[36,138],
  korea:[36,128]
};

let markers={};

for(let c in countries){
  let pos=latLongToVector3(countries[c][0],countries[c][1],2.1);
  let marker=new THREE.Mesh(
    new THREE.SphereGeometry(0.08,16,16),
    new THREE.MeshBasicMaterial({color:0xff4da6})
  );
  marker.position.copy(pos);
  marker.userData.country=c;
  scene.add(marker);
  markers[c]=marker;
}

/* raycaster click */
let raycaster=new THREE.Raycaster();
let mouse=new THREE.Vector2();

window.addEventListener("click",function(event){
  mouse.x=(event.clientX/window.innerWidth)*2-1;
  mouse.y=-(event.clientY/window.innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);
  let intersects=raycaster.intersectObjects(Object.values(markers));
  if(intersects.length>0){
    travel(intersects[0].object.userData.country);
  }
});

/* notes */
const notes={
india:`Happy Birthday ğŸŒ™âœ¨<br><br>
If birthdays were wishes... <span class="gold">Nimra ğŸ’•</span> ğŸŒ¸ğŸ«ğŸ’–ğŸŒ¹<br><br>
à¤œà¤¨à¥à¤®à¤¦à¤¿à¤¨ à¤®à¥à¤¬à¤¾à¤°à¤• à¤¹à¥‹ ğŸ‰`,
saudi:`Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ Ø³Ø¹ÙŠØ¯ ğŸ‰ğŸŒ¸ğŸ« <span class="gold">Nimra ğŸ’•</span>`,
japan:`ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã† ğŸ‰ğŸŒ¸ğŸ« <span class="gold">Nimra ğŸ’•</span>`,
korea:`ìƒì¼ ì¶•í•˜í•´ìš” ğŸ‰ğŸŒ¸ğŸ« <span class="gold">Nimra ğŸ’•</span>`
};

function travel(country){
  globeSection.classList.replace("visible","hidden");
  ending.classList.replace("hidden","visible");
  jetSound.play();
  document.getElementById("note").innerHTML=notes[country];
}

/* petals */
setInterval(()=>{
  let petal=document.createElement("div");
  petal.className="petal";
  petal.innerHTML="ğŸŒ¹";
  petal.style.left=Math.random()*100+"vw";
  petal.style.animationDuration=(5+Math.random()*5)+"s";
  document.body.appendChild(petal);
  setTimeout(()=>petal.remove(),10000);
},400);

/* mic blow */
let audioContext,analyser,dataArray;
document.addEventListener("click",async()=>{
  try{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    audioContext=new(window.AudioContext||window.webkitAudioContext)();
    analyser=audioContext.createAnalyser();
    const mic=audioContext.createMediaStreamSource(stream);
    mic.connect(analyser);
    analyser.fftSize=256;
    dataArray=new Uint8Array(analyser.frequencyBinCount);
    detectBlow();
  }catch(e){}
},{once:true});

function detectBlow(){
  analyser.getByteFrequencyData(dataArray);
  let volume=dataArray.reduce((a,b)=>a+b)/dataArray.length;
  if(volume>45){
    document.querySelector(".flame").style.opacity="0";
    confetti({particleCount:150,spread:90,origin:{y:0.6}});
  }
  requestAnimationFrame(detectBlow);
}

function goBack(){
  ending.classList.replace("visible","hidden");
  globeSection.classList.replace("hidden","visible");
}
</script>

</body>
</html>
